"use strict";angular.module("chemartApp",["ngCookies","ngResource","ngSanitize","ui.router"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.otherwise("/"),c.html5Mode(!0)}]),angular.module("chemartApp").controller("MainCtrl",["$scope","$http","moleculeDrawer","canvas","storage",function(a,b,c,d,e){a.canvas=d,a.storage=e,e["new"](),a.modes=Mol3D.Mode,a.displays=Mol3D.Display,a.mode=function(a){d.setMode(a)},d.show();var f=document.getElementById("canvas-container");angular.element(f).append(d.renderer.domElement),a.build=function(){var a=d.getMolecule();b.post("/api/geometry/build",a.toJSON()).success(function(a){var b=Chem.Molecule.readJSON(a);c(b)})},a.addHydrogens=function(){var a=d.getMolecule();b.post("/api/geometry/addhydrogens",a.toJSON()).success(function(a){var b=Chem.Molecule.readJSON(a);c(b)})},a.help=function(){angular.element(document.querySelector("help")).addClass("show")},a.about=function(){angular.element(document.querySelector("about")).addClass("show")}}]),angular.module("chemartApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("chemartApp").factory("canvas",function(){if(window.WebGLRenderingContext){var a=new Mol3D.Canvas;return a.setDisplay(Mol3D.Display.BallAndStick),a.setMode(Mol3D.Mode.Editor),angular.element(window).on("resize",function(){a.camera.aspect=window.innerWidth/window.innerHeight,a.camera.updateProjectionMatrix(),a.renderer.setSize(this.innerWidth,this.innerHeight)}),a}document.getElementById("browsehappy").style.display="block"}),angular.module("chemartApp").factory("centerAtoms",function(){return function(a){var b,c,d=new THREE.Vector3,e=a.atoms.length;for(b=a.atoms.length;b--;)c=a.atoms[b].position,d.x+=c.x,d.y+=c.y,d.z+=c.z;for(d.x/=e,d.y/=e,d.z/=e,b=a.atoms.length;b--;)c=a.atoms[b].position,c.x-=d.x,c.y-=d.y,c.z-=d.z}}),angular.module("chemartApp").factory("moleculeDrawer",["centerAtoms","canvas",function(a,b){return function(c){function d(){Date.now()<h&&requestAnimationFrame(d),TWEEN.update(),b.update()}var e=b.getMolecule(),f=200;a(c);for(var g in c.atoms)"undefined"!=typeof e.atoms[g]&&new TWEEN.Tween(e.atoms[g].position).to(c.atoms[g].position,f).easing(TWEEN.Easing.Circular.Out).start();var h=Date.now()+f;d(),setTimeout(function(){b.clear(),b.attach(c)},f)}}]),angular.module("chemartApp").factory("storage",function(){var a={data:localStorage.molecules||{},current:null};return a["new"]=function(){var a=new Date,b="Untitled-"+a.getFullYear()+a.getMonth()+a.getDate()+"-"+a.getHours()+a.getMinutes()+a.getSeconds();this.data[b]=[],this.setCurrent(b)},a.save=function(a){a&&this.current&&(this.data[this.current]=a),localStorage.molecules=this.data},a.get=function(a){return this.data[a]},a.rename=function(a,b){this.data[b]=this.data[a],delete this.data[a],this.save()},a.list=function(){return _.keys(this.data)},a.setCurrent=function(a){this.current=a},a}),angular.module("chemartApp").directive("about",function(){return{restrict:"E",link:function(a,b){b.on("click",function(){b.removeClass("show").addClass("hide"),setTimeout(function(){b.removeClass("hide")},1e3)})},templateUrl:"components/about/about.html"}}),angular.module("chemartApp").directive("chooseElement",function(){return{restrict:"E",link:function(a,b){a.close=function(){b.removeClass("show").addClass("hide"),setTimeout(function(){b.removeClass("hide")},1e3)},a.setElement=function(b){a.canvas.data.element=b,a.close()},a.quick=[Chem.Element.findByAtomicNumber(1),Chem.Element.findByAtomicNumber(6),Chem.Element.findByAtomicNumber(7),Chem.Element.findByAtomicNumber(8),Chem.Element.findByAtomicNumber(16)]},templateUrl:"components/element/element.html"}}),angular.module("chemartApp").directive("help",function(){return{restrict:"E",link:function(a,b){b.on("click",function(){b.removeClass("show").addClass("hide"),setTimeout(function(){b.removeClass("hide")},1e3)})},templateUrl:"components/help/help.html"}}),angular.module("chemartApp").controller("MenubarCtrl",["$scope","$location",function(a){a.print=function(){window.print()}}]),angular.module("chemartApp").controller("ToolbarCtrl",["$scope","$location",function(a){a.selectElement=function(){angular.element(document.querySelector("choose-element")).addClass("show")}}]),angular.module("chemartApp").run(["$templateCache",function(a){a.put("app/main/main.html","<div ng-include=&quot;components/menubar/menubar.html&quot;></div><div ng-include=&quot;components/toolbar/toolbar.html&quot;></div><div id=canvas-container></div><choose-element></choose-element><help></help><about></about><div ng-include=&quot;components/footer/footer.html&quot;></div>"),a.put("components/about/about.html",'<div class=about><a class=close><i class="icon icon-close"></i></a><h1>Chemozart</h1><div><small>version 1.0.0-alpha</small></div><hr><p>Chemozart is an open-source online web-based chemical visualization tool with RESTful cloud-based optimization API. This project is built on top of these packages :</p><ul><li><a href=https://github.com/mohebifar/openbabel-node>openbabel-node</a> - A port of <a href=http://openbabel.org target=_blank>Open Babel</a> in node.js</li><li><a href=https://github.com/mohebifar/mol3d>mol3d</a> - A 3D molecular visualization tool on top of WebGL</li><li><a href=https://github.com/mohebifar/chem.js>chem.js</a> - A molecular modeling library written in javascript</li></ul><p>This software is published under<a href=http://www.apache.org/licenses/LICENSE-2.0 target=_blank>Apache License v2.0</a></p></div>'),a.put("components/element/element.html",'<div class=major-elements><a ng-click=close() class=close><i class="icon icon-close"></i></a><h1>Choose Elements</h1><hr><div class=quick><div ng-repeat="element in quick" ng-class="{&quot;active&quot;: element.atomicNumber===canvas.data.element}" ng-click=setElement(element.atomicNumber) class=element><span ng-bind=element.atomicNumber class=atomic-number></span><span ng-bind=element.symbol class=symbol></span><span ng-bind=element.name class=name></span></div></div></div>'),a.put("components/footer/footer.html","<footer>Made by <a target=_blank href=https://mohebifar.com>Mohamad Mohebifar</a> at <a target=_blank href=http://sbu.ac.ir>Shahid Beheshti University</a></footer>"),a.put("components/help/help.html",'<div class=help><a class=close><i class="icon icon-close"></i></a><h2>Modes</h2><h3>Camera Mode</h3><div class=control-help><p><strong>Rotate</strong><span>Mouse move holding left button</span></p><p><strong>Pan</strong><span>Mouse move holding right button</span></p><p><strong>Zoom</strong><span>Scroll | Mouse move holing middle button</span></p></div><h3>Editing Mode</h3><div class=control-help><p><strong>Add Atom</strong><span>Click on empty space</span></p><p><strong>Remove Atom</strong><span>Right click on an atom</span></p><p><strong>Add bond</strong><span>Drag from one atom to another</span></p><p><strong>Remove bond</strong><span>Right click on bond</span></p><p><strong>Increase bond order</strong><span>Click on bond</span></p></div></div>'),a.put("components/menubar/menubar.html","<div ng-controller=MenubarCtrl class=menubar><ul><li><a>File</a><ul><li><a ng-click=canvas.clear()>New</a></li><li><a ng-click=print()>Print</a></li></ul></li><li><a>Edit</a><ul><li><a ng-click=canvas.clear()>Clear</a></li></ul></li><li><a>Build</a><ul><li><a ng-click=build()>Build 3D</a></li><li><a ng-click=addHydrogens()>Add Hydrogens</a></li></ul></li><li><a>Help</a><ul><li><a ng-click=help()>Help Topics</a></li><li><a ng-click=about()>About</a></li></ul></li></ul><div class=right><div class=name>{{ storage.current }}</div>-<div class=logo>CHEMOZART v1.0</div></div></div>"),a.put("components/toolbar/toolbar.html",'<div ng-controller=ToolbarCtrl class=toolbar><ul><li><a ng-click=mode(modes.Orbit) ng-class="{&quot;active&quot;: canvas.currentMode === modes.Orbit}" title="Positioning the camera"><i class="icon icon-move"></i></a></li><li><a ng-click=mode(modes.Editor) ng-class="{&quot;active&quot;: canvas.currentMode === modes.Editor}" title="Editing the molecule"><i class="icon icon-edit"></i></a></li><li><a ng-click=selectElement() title="Choose the element from periodic table"><i class="icon icon-atom"></i></a></li><li><a ng-click="" title="Reposition the atoms"><i class="icon icon-pointer"></i></a></li><li class=separator></li><li><a ng-click=help() title=Help><i class="icon icon-help"></i></a></li><li><a href=https://github.com/mohebifar/chemozart target=_blank title="Source on Github"><i class="icon icon-github"></i></a></li></ul></div>')}]);